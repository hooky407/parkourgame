#怪物类
class Monster:
    def __init__(self, x, y, monster_type):
        """
        怪物基类
        Args:
            x, y: 初始位置
            monster_type: 怪物类型
        """
        # 基本属性
        self.x = x
        self.y = y
        self.width = 60
        self.height = 60
        self.type = monster_type
        
        # 战斗属性
        self.health = 100  # 血量
        self.max_health = 100
        self.damage = 10   # 攻击力
        self.speed = 2     # 移动速度
        self.attack_range = 50  # 攻击范围
        self.attack_cooldown = 0  # 攻击冷却
        
        # 状态
        self.is_alive = True
        self.is_attacking = False
        
        # 视觉
        self.color = self.get_color_by_type()
        self.animation_frame = 0
        
    def get_color_by_type(self):
        """根据怪物类型返回颜色"""
        colors = {
            "slime": (0, 255, 0),      # 绿色史莱姆
            "goblin": (139, 69, 19),   # 棕色哥布林
            "bat": (75, 0, 130),       # 紫色蝙蝠
            "boss": (255, 0, 0)        # 红色Boss
        }
        return colors.get(self.type, (128, 128, 128))
    
    def update(self):
        """更新怪物状态"""
        if not self.is_alive:
            return
            
        # 移动（向左移动，因为背景在向右滚动的错觉）
        self.x -= self.speed
        
        # 更新攻击冷却
        if self.attack_cooldown > 0:
            self.attack_cooldown -= 1
            
        # 动画更新
        self.animation_frame = (self.animation_frame + 1) % 60
        
    def take_damage(self, damage):
        """受到伤害"""
        self.health -= damage
        if self.health <= 0:
            self.die()
            return True  # 返回是否死亡
        return False
    
    def die(self):
        """死亡处理"""
        self.is_alive = False
        # 可以在这里添加死亡动画、掉落物品等
        
    def attack(self, player):
        """攻击玩家"""
        if self.attack_cooldown > 0:
            return False
            
        # 检查是否在攻击范围内
        distance = abs(self.x - player.x)
        if distance <= self.attack_range:
            self.is_attacking = True
            self.attack_cooldown = 30  # 30帧冷却
            return True
        return False
        
    def draw(self, screen):
        """绘制怪物"""
        if not self.is_alive:
            return
            
        # 绘制怪物主体
        pygame.draw.rect(screen, self.color, 
                        (self.x, self.y, self.width, self.height))
        
        # 绘制血条
        self.draw_health_bar(screen)
        
        # 绘制攻击动画
        if self.is_attacking:
            self.draw_attack_effect(screen)
            self.is_attacking = False
            
    def draw_health_bar(self, screen):
        """绘制血条"""
        bar_width = self.width
        bar_height = 5
        health_percent = self.health / self.max_health
        
        # 血条背景（红色）
        pygame.draw.rect(screen, (255, 0, 0),
                        (self.x, self.y - 10, bar_width, bar_height))
        
        # 当前血量（绿色）
        pygame.draw.rect(screen, (0, 255, 0),
                        (self.x, self.y - 10, bar_width * health_percent, bar_height))
#子弹类
class Bullet:
    def __init__(self, x, y, direction="right", damage=20):
        """
        子弹类
        Args:
            x, y: 发射位置
            direction: 发射方向
            damage: 伤害值
        """
        self.x = x
        self.y = y
        self.width = 15
        self.height = 5
        self.speed = 10
        self.damage = damage
        self.direction = direction  # "right" 或 "left"
        self.is_active = True
        
    def update(self):
        """更新子弹位置"""
        if self.direction == "right":
            self.x += self.speed
        else:
            self.x -= self.speed
            
        # 如果飞出屏幕，标记为无效
        if self.x > 1000 or self.x < -50:
            self.is_active = False
            
    def draw(self, screen):
        """绘制子弹"""
        if not self.is_active:
            return
        pygame.draw.rect(screen, (255, 255, 0),  # 黄色子弹
                        (self.x, self.y, self.width, self.height))
#技能系统
class Skill:
    def __init__(self, name, skill_type, cooldown, damage, effect):
        """
        技能类
        Args:
            name: 技能名称
            skill_type: 技能类型（"projectile", "area", "buff"）
            cooldown: 冷却时间（帧数）
            damage: 伤害值
            effect: 特殊效果
        """
        self.name = name
        self.type = skill_type
        self.cooldown = cooldown
        self.current_cooldown = 0
        self.damage = damage
        self.effect = effect
        self.is_ready = True
        
    def update(self):
        """更新冷却时间"""
        if self.current_cooldown > 0:
            self.current_cooldown -= 1
            if self.current_cooldown <= 0:
                self.is_ready = True
                
    def use(self, player, target_pos=None):
        """使用技能"""
        if not self.is_ready:
            return None
            
        self.current_cooldown = self.cooldown
        self.is_ready = False
        
        # 根据技能类型返回不同的攻击效果
        if self.type == "projectile":
            return self.create_projectile(player, target_pos)
        elif self.type == "area":
            return self.create_area_effect(player)
        elif self.type == "buff":
            self.apply_buff(player)
            return None
            
    def create_projectile(self, player, target_pos):
        """创建投射物"""
        # 从玩家位置发射
        bullet = Bullet(
            x=player.x + player.width,
            y=player.y + player.height // 2,
            direction="right",
            damage=self.damage
        )
        return bullet
        
    def create_area_effect(self, player):
        """创建范围效果"""
        # 创建一个范围攻击区域
        area_attack = {
            "x": player.x - 50,
            "y": player.y - 50,
            "width": 150,
            "height": 150,
            "damage": self.damage,
            "duration": 10  # 持续10帧
        }
        return area_attack
        
    def apply_buff(self, player):
        """应用增益效果"""
        if self.effect == "speed_boost":
            player.speed_multiplier = 1.5
            player.buff_timer = 180  # 3秒
            
        elif self.effect == "invincible":
            player.is_invincible = True
            player.buff_timer = 120  # 2秒
